  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CS171 Homework 1</title>

    <style type="text/css">

    tr, td, th {
      padding: 2px;
      border: 1px black solid;
      font-family: Tahoma, sans-serif;
      font-size: small;
      text-align: center;
      border-collapse: collapse;
    }

    table {
      padding: 2px;
      border: 1px black solid;
      font-family: Tahoma, sans-serif;
      margin-left: auto;
      margin-right: auto;
      border-collapse: collapse;
    }

    caption {
      padding: 2px;
      border-top: 1px black solid;
      border-bottom: 0px;
      border-left: 1px black solid;
      border-right: 1px black solid;
      font-family: Tahoma, sans-serif;
      font-weight: bold;
      font-size: 14;
    }

    </style>
  </head>
  <body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>

    var body = d3.select("body");

    var h1 = body.append("h1");
    h1.text("Unemployment Rates for States")
    .style("font-size", "12")
    .style("text-align", "center")

    d3.text("unemp_states_us_nov_2013.tsv", function(_data){

      var data = d3.tsv.parseRows(_data);

      var headers = data.slice(0,1);
      var states = data.slice(1);

      var table = d3.select("body").append("table")
      var thead = table.append("thead")
      var tbody = table.append("tbody")
      var caption = table.append("caption")
      caption.html("Monthly Rankings" + "</br>" + "Seasonally Adjusted" + "</br>" + "Nov. 2013" + "</br>");

      var color = d3.scale.linear()
      .domain(d3.extent(data, function (d) { return +d[2]; }))
      .interpolate(d3.interpolateRgb)
      .range(["lightblue", "orangered"]);

      var StateSortA = function(a, b) { 
          return d3.ascending(a[1], b[1]) 
      };

      var StateSortD = function(a,b) {
          return d3.descending(a[1], b[1]) 
      };

      var RateSortA = function(a,b) {
          if (a[2] === b[2]) {
          return d3.ascending(a[1], b[1])
          }
          else {
            return +d3.ascending(a[2], b[2])
          }
        };

      var RateSortD = function(a,b) {   
          if (a[2] === b[2]) {
          return d3.descending(a[1], b[1])
        }
        else {
          return +d3.descending(a[2], b[2])
        }
      };

      var GraphSortA = function(a,b) {
        if (a[0] === b[0]) {
        return d3.ascending(a[1], b[1])
          }
          else {
            return d3.ascending(parseFloat(a[0]), parseFloat(b[0]))
          }
        };


      var GraphSortD = function(a,b) {
        if (a[0] === b[0]) {
        return d3.descending(a[1], b[1])
          }
          else {
            return d3.descending(parseFloat(a[0]), parseFloat(b[0]))
          }
        };

      var CheckStateAsc = true;
      var CheckRateAsc = true;
      var CheckBarAsc = true;

      var heading = thead.selectAll("tr")
      .data(headers)
      .enter()
      .append("tr");

      var zebra = function(d, i) {
       if (i%2===0){return "lightblue";}else{return "white";}
     };

      var gradient = function (d, i) { 
        if (i === 2) { 
        return color(d);
      }};

     heading.selectAll("th")
     .data(function(row) {
      return d3.range(Object.keys(row).length).map(function(column, i) {
        return row[Object.keys(row)[i]];
      });
    })
     .enter()
     .append("th")
     .text(function(d) { return d; });

      heading.insert("th")
      .html("</br>" + "Graph")
      .append("svg");

      var headerrow = heading.selectAll("th")
     .on("click", function (d, i) { 
      var sort;

      if (i===1) {
        if (CheckStateAsc === true) {
          sort = StateSortD;
          CheckStateAsc = false;
        }
        else {
          sort = StateSortA;
          CheckStateAsc = true;
        }
      }
      if (i === 2) {
        if (CheckRateAsc === true) {     
          sort = RateSortD;
          CheckRateAsc = false;
        }
        else {
          sort = RateSortA;
          CheckRateAsc = true;
        }
      }
      if (i === 3) {
        if (CheckBarAsc === true) {     
          sort = GraphSortD;
          CheckBarAsc = false;
        }
        else {
          sort = GraphSortA;
          CheckBarAsc = true;
        }
      }


        var rowsort = tbody.selectAll("tr").sort(sort) 
        .style("background-color", zebra)
      })
      .on("mouseover", function (d, i) {d3.select(this).style("cursor", function() {
        if (i===1) {
          if (CheckStateAsc === true) {
            return "n-resize";
          }
          else {
            return "s-resize";
          }
        }
        if (i === 2) {
          if (CheckRateAsc === true) {
            return "n-resize";
          }
          else {
            return "s-resize";
          }
      }
    })});

     var rows = tbody.selectAll("tr")
     .data(states)
     .enter()
     .append("tr")
     .on("mouseover", function (){d3.select(this).style("background-color", "yellow");})
     .on("mouseout", function (d, i){d3.select(this).style("background-color", function(){
      if (i%2===0){return "lightblue";}else{return "white";}
    })})
     .sort(RateSortA)
     .style("background-color", zebra);

     rows.selectAll("td")
       .data(function(row) {
        return d3.range(Object.keys(row).length).map(function(column, i) {
          return row[Object.keys(row)[i]];
        });})
       .enter()
       .append("td")
       .text(function(d) { return d; });

     rows.insert("td").append("svg")
       .attr("width", 60)
       .attr("height", 15)
       .append("rect")
       .attr("height", 15)
       .attr("width", function(d) { return parseFloat(d[0]); });

    var cells = rows.selectAll("td")
     .attr("class", function (d, i) { return "column_" + i; })
     .on("mouseover", function (d, i) {d3.selectAll("td.column_" + i).style("background-color", "yellow");})
     .on("mouseout", function (d, i) {d3.selectAll("td.column_" + i).style("background-color", null )}); // FIX MOUSEOUT

     var td = d3.selectAll("tbody tr").selectAll("td")
     .style("background-color", gradient);

   });
  </script>
</body>
</html>
